
# Get Kafka up and running locally with a simple script

# Steps:
# 1. Launch Zookeeper in its own process
# 2. Launch Kafka Server in a different process from 1.
# 3. Create a topic


# ~/kafka/bin/zookeeper-server-start.sh config/zookeeper.properties  # Launch ZooKeeper in one process
# ~/kafka/bin/kafka-server-start.sh config/server.properties  # Launch Kafka server in one process
# ~/kafka/bin/kafka-topics.sh --create --topic quickstart-events --bootstrap-server localhost:9092  # Create a topic
# ~/kafka/bin/kafka-console-producer.sh --topic quickstart-events --bootstrap-server localhost:9092 # Create producer in one process
# ~/kafka/bin/kafka-console-consumer.sh --topic quickstart-events --from-beginning --bootstrap-server localhost:9092 # Creat`e consumer in one process

# Constants - perhaps some can be made into command line args
KAFKA_DIR="/home/matt/kafka/kafka_2.13-3.2.1"
LOG_DIR="/home/matt/kafka/logs/$(date +%Y%m%d%H%M%S)"
SERVER_LOG="$LOG_DIR/kafka_server.log"
ZOOKEEPER_LOG="$LOG_DIR/zookeeper.log"
TOPIC="VEHICLE METRICS"
echo $ZOOKEEPER_LOG

# Create the logging directory
if [ ! -d "$LOG_DIR" ]; then
    sudo mkdir -p "$LOG_DIR"
fi

# Launch Zookeeper in its own process
sudo touch "$ZOOKEEPER_LOG"
sudo chmod +r-- "$ZOOKEEPER_LOG"
cd $KAFKA_DIR && bin/zookeeper-server-start.sh config/zookeeper.properties | sudo tee "$ZOOKEEPER_LOG" &

# PID for ZooKeeper: ps -eo pid,command | grep "QuorumPeer" | grep -v grep | awk '{print $1}' 

# Launch Kafka in its own process
sudo touch "$SERVER_LOG"
sudo chmod +r-- "$SERVER_LOG"
cd $KAFKA_DIR && bin/kafka-server-start.sh config/server.properties | sudo tee "$SERVER_LOG" &
